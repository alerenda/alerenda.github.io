<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Alessandro  Renda


  | IDOR Lab Report

</title>
<meta name="description" content="Research Fellow @ University of Trieste
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://github.com/alerenda/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/teaching/cybersecurity/idor/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>







    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <span class="font-weight-bold">Alessandro</span>   Renda
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
        
          
        
          
        
          
        
          
        
          
        
          
            
              <!-- Other normal pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">
                  publications
                  
                </a>
              </li>
            
          
        
          
            
              <!-- Teaching dropdown -->
              <li class="nav-item dropdown active">
                <a class="nav-link dropdown-toggle" href="/teaching/" id="teachingDropdown">
                  teaching
                </a>
                <div class="dropdown-menu" aria-labelledby="teachingDropdown">
                  <a class="dropdown-item" href="/teaching/fondamenti/">Fondamenti di Informatica</a>
                  <a class="dropdown-item" href="/teaching/cybersecurity/">Cybersecurity Lab</a>
                </div>
              </li>
            
          
        
          
            
              <!-- Other normal pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/talks/">
                  talks
                  
                </a>
              </li>
            
          
        
          
            
              <!-- Other normal pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">
                  projects
                  
                </a>
              </li>
            
          
        
          
            
              <!-- Other normal pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/activity/">
                  activity
                  
                </a>
              </li>
            
          
        
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">IDOR Lab Report</h1>
    <p class="post-description">Report on IDOR lab activity</p>
  </header>

  <article>
    <h1 id="idor-vulnerabilities">IDOR Vulnerabilities</h1>

<p>In this report, the OWASP Juice Shop webapp is used to showcase the exploitation of two IDOR vulnerabilities.
Part of this document is based on material from prof. Alberto Bartoli.</p>

<h2 id="tools">Tools</h2>
<ul>
  <li>OWASP Juice Shop (running from Docker image) v18.0.0</li>
  <li>BURP Suite Proxy v2025.7.4</li>
</ul>

<h2 id="challenge-1-view-basket">Challenge #1. View Basket</h2>

<blockquote>
  <p><cite>Description: View another user’s shopping basket</cite></p>
</blockquote>

<p>Of course, this is a mistake in the code of the webapp, i.e., a vulnerability: a user must not be able to see data private of another user.</p>

<h3 id="preliminary-steps">Preliminary steps</h3>
<ol>
  <li>Create two accounts, e.g.:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">a@gmail.com</code></li>
      <li><code class="language-plaintext highlighter-rouge">b@gmail.com</code></li>
    </ul>
  </li>
  <li>Login as <code class="language-plaintext highlighter-rouge">a@gmail.com</code></li>
  <li>Add a product to the basket</li>
  <li>Visualize the content of the basket by clicking on the cart icon:
<img src="https://alerenda.github.io/assets/reports/IDOR/images/basketa.png" alt="basketa" /></li>
  <li>Logout and then login as the other user, i.e., <code class="language-plaintext highlighter-rouge">b@gmail.com</code></li>
  <li>Add a product to the basket</li>
</ol>

<h3 id="discovery">Discovery</h3>
<ol>
  <li>Set <code class="language-plaintext highlighter-rouge">Intercept On</code>.</li>
  <li>Visualize the content of the basket by clicking on the cart icon.
BURP will intercept, among others, a <code class="language-plaintext highlighter-rouge">GET</code> requests to the endpoint <code class="language-plaintext highlighter-rouge">/rest/basket/7</code></li>
</ol>

<p><img src="https://alerenda.github.io/assets/reports/IDOR/images/basketrequest.png" alt="basketrequest" /></p>

<p>Notice that, as requests are stalling, the content of the basket is not showing up.</p>
<ol>
  <li>Set <code class="language-plaintext highlighter-rouge">Intercept Off</code> and make sure the shopping basket has been fully displayed. Under the hood, the client-side JavaScript has processed the server response and has dynamically updated the DOM to display the basket content. 
<img src="https://alerenda.github.io/assets/reports/IDOR/images/basketb.png" alt="basketb" /></li>
  <li>Go to the <code class="language-plaintext highlighter-rouge">HTTP History</code> tab and inspect the response to the request <code class="language-plaintext highlighter-rouge">GET</code> <code class="language-plaintext highlighter-rouge">/rest/basket/7</code>. The resource in the body of the response is represented in JSON:
    <pre><code class="language-JSON">{
 "status":"success",
 "data":{
     "id":7,
     "coupon":null,
     "UserId":24,
     "createdAt":"2025-09-10T14:37:23.218Z",
     "updatedAt":"2025-09-10T14:37:23.218Z",
     "Products":[
         {
             "id":6,
             "name":"Banana Juice (1000ml)",
             "description":"Monkeys love it the most.",
             "price":1.99,
             "deluxePrice":1.99,
             "image":"banana_juice.jpg",
             "createdAt":"2025-09-10T14:05:01.949Z",
             "updatedAt":"2025-09-10T14:05:01.949Z",
             "deletedAt":null,
             "BasketItem":{
                 "ProductId":6,
                 "BasketId":7,
                 "id":10,
                 "quantity":1,
                 "createdAt":"2025-09-10T14:37:57.462Z",
                 "updatedAt":"2025-09-10T14:37:57.462Z"
             }
         }
     ]
 }
}
</code></pre>
  </li>
</ol>

<p>Observations:</p>

<blockquote>
  <p>The request <code class="language-plaintext highlighter-rouge">GET</code> <code class="language-plaintext highlighter-rouge">/rest/basket/7</code> may be suggestive of an <strong>IDOR vulnerability</strong>: the parameter in the URL path represents a direct object reference, which identifies the shopping basket of this user.</p>
</blockquote>

<blockquote>
  <p>The value of the parameter in the URL path (i.e., <code class="language-plaintext highlighter-rouge">7</code>) is a small integer and, as such, it is enumerable and seems highly predictable. <em>The strategy of using not predictable and not enurmerable references</em> is not implemented.</p>
</blockquote>

<blockquote>
  <p>Ultimately, the presence of an IDOR vulnerability depends on whether the application enforces proper authorization checks.</p>
</blockquote>

<p>The actual exploitation attempt procedure is outlined in the following:</p>

<ol>
  <li>Go to the <code class="language-plaintext highlighter-rouge">HTTP History</code> tab and select the request <code class="language-plaintext highlighter-rouge">GET</code> <code class="language-plaintext highlighter-rouge">/rest/basket/7</code>.</li>
  <li>Right click on it and select <code class="language-plaintext highlighter-rouge">Send to Repeater</code></li>
  <li>Move to the <code class="language-plaintext highlighter-rouge">Repeater</code> tab. Modify the request by incrementing or decrementing the url parameter.</li>
  <li>Click on send and check the response.
<img src="https://alerenda.github.io/assets/reports/IDOR/images/repeater.png" alt="alt text" /></li>
  <li>Note that the basket represented in JSON within the response is the one related to the user <code class="language-plaintext highlighter-rouge">a@gmail.com</code>, whereas the current user, who sent the request, is <code class="language-plaintext highlighter-rouge">b@gmail.com</code>.</li>
  <li>Check the browser. A <em>vulnerability found</em> banner will show up.</li>
</ol>

<blockquote>
  <p>The web application is vulnerable to IDOR: due to missing authorization checks, a user can access the shopping basket of another user.</p>
</blockquote>

<h3 id="exploiting-in-practice">Exploiting in practice</h3>
<p>Decrementing the parameter was just an educated guess (the account <code class="language-plaintext highlighter-rouge">a@gmail.com</code> was manually created few seconds before <code class="language-plaintext highlighter-rouge">b@gmail.com</code>).</p>

<p>In a practical setting the attacker would not know how many users are logged in and what their corresponding “small integer” values are. 
The attacker would thus have to repeatedly send <code class="language-plaintext highlighter-rouge">GET</code> <code class="language-plaintext highlighter-rouge">/rest/basket/basket-id</code>, with many different values for <code class="language-plaintext highlighter-rouge">basket-id</code>.</p>

<p>This procedure can be automated in BURP with the Intruder module, as follows.</p>

<ol>
  <li>Go to the <code class="language-plaintext highlighter-rouge">HTTP History</code> tab and select the request <code class="language-plaintext highlighter-rouge">GET</code> <code class="language-plaintext highlighter-rouge">/rest/basket/7</code> (as before, logged in as <code class="language-plaintext highlighter-rouge">b@gmail.com</code>)</li>
  <li>Right click on it and select <code class="language-plaintext highlighter-rouge">Send to Intruder</code></li>
  <li>Move to the <code class="language-plaintext highlighter-rouge">Intruder</code> tab.</li>
  <li>Specify which part of the request has to be modified at each iteration: select the parameter value <code class="language-plaintext highlighter-rouge">7</code> in the request and click on <code class="language-plaintext highlighter-rouge">Add §</code>. The request will appear as follows: <code class="language-plaintext highlighter-rouge">GET /rest/basket/§7§</code>
<img src="https://alerenda.github.io/assets/reports/IDOR/images/intruder.png" alt="alt text" /></li>
  <li>Specify how to modify the selected part of the URL at each iteration: in the <code class="language-plaintext highlighter-rouge">Payloads tab</code> set <code class="language-plaintext highlighter-rouge">Payload Type: Numbers</code> and set a reasonable range (e.g., <code class="language-plaintext highlighter-rouge">Sequential</code> from 1 to 10 with step 1).</li>
  <li>Specify which part of the response will be extracted and shown in the results window: on the side Menu on the right, click on the <code class="language-plaintext highlighter-rouge">Settings</code> tab; in the <code class="language-plaintext highlighter-rouge">Grep - Extract</code> section, click on <code class="language-plaintext highlighter-rouge">Add</code>. Selecting a portion of text in the response will create a suitable configuration automatically. Click <code class="language-plaintext highlighter-rouge">Ok</code>.
<img src="https://alerenda.github.io/assets/reports/IDOR/images/grepmatch.png" alt="alt text" /></li>
  <li>Click on <code class="language-plaintext highlighter-rouge">Start attack</code>.</li>
  <li>A window related to the attack will appear. The column <em>“success”</em> (the name derives from the <em>‘start from’ expression</em>) shows the content of the extracted text for each response. Note that the payloads 8, 9, 10 probably do not represent valid values of <code class="language-plaintext highlighter-rouge">basket-id</code>, as the extracted value of <code class="language-plaintext highlighter-rouge">data</code> is null. In the bottom part of the window, each request and response can be inspected.
<img src="https://alerenda.github.io/assets/reports/IDOR/images/intruderresults.png" alt="alt text" /></li>
</ol>

<h2 id="challenge-2-manipulate-basket">Challenge #2. Manipulate Basket</h2>
<blockquote>
  <p><cite> Description: Put an additional product into another user’s shopping basket.</cite></p>
</blockquote>

<p>The preliminary steps of the previous challenge can be leveraged.</p>

<h3 id="discovery-1">Discovery</h3>
<ol>
  <li>Set <code class="language-plaintext highlighter-rouge">Intercept On</code>.</li>
  <li>In the browser, add a product to the basket.</li>
  <li>BURP will intercept a <code class="language-plaintext highlighter-rouge">GET /rest/basket/7</code>. Forward it.</li>
  <li>BURP will then intercept, among others, a <code class="language-plaintext highlighter-rouge">POST</code> requests to the endpoint <code class="language-plaintext highlighter-rouge">/api/BasketItems</code> with the following body 
<code class="language-plaintext highlighter-rouge">{"ProductId":42,"BasketId":"7","quantity":1}</code>
<img src="https://alerenda.github.io/assets/reports/IDOR/images/additem.png" alt="additem" /></li>
  <li>Set <code class="language-plaintext highlighter-rouge">Intercept Off</code> and make sure the shopping basket has been updated.</li>
</ol>

<p>Observations:</p>

<blockquote>
  <p>The request <code class="language-plaintext highlighter-rouge">POST</code> <code class="language-plaintext highlighter-rouge">/api/BasketItems</code> may be suggestive of an <strong>IDOR vulnerability</strong>: the parameter <code class="language-plaintext highlighter-rouge">BasketId</code>in the request body represents a direct object reference, which identifies the shopping basket to be updated, associated with the current user.</p>
</blockquote>

<p>The actual exploitation attempt procedure is outlined in the following:</p>

<ol>
  <li>Go to the <code class="language-plaintext highlighter-rouge">HTTP History</code> tab and select the request <code class="language-plaintext highlighter-rouge">POST</code> <code class="language-plaintext highlighter-rouge">/api/BasketItems</code>.</li>
  <li>Right click on it and select <code class="language-plaintext highlighter-rouge">Send to Repeater</code></li>
  <li>Move to the <code class="language-plaintext highlighter-rouge">Repeater</code> tab. Modify the request as before (e.g., decrementing the id)</li>
  <li>Click on send and check the response.</li>
  <li>Note that the response code and status indicate <code class="language-plaintext highlighter-rouge">401 Unauthorized</code> with body <code class="language-plaintext highlighter-rouge">{'error': 'Invalid BasketId'}</code>
<img src="https://alerenda.github.io/assets/reports/IDOR/images/correctauth.png" alt="alt text" /></li>
</ol>

<blockquote>
  <p>At a first glance, an authorization mechanism is in place. However, the presence of such a check does not necessarily mean that the authorization functionality is free of flaws: it may still be vulnerable to IDOR (<em>and indeed it is, since this challenge exists</em>). Further hints provided by the <a href="https://pwning.owasp-juice.shop/companion-guide/latest/part2/broken-access-control.html#_put_an_additional_product_into_another_users_shopping_basket">companion website</a>  may help identify where the authorization logic fails and how the vulnerability can be exploited.</p>
</blockquote>

<p><strong>Try to complete the challenge! Also report any uncessful attempt you find interesting.</strong></p>

  </article>

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2025 Alessandro  Renda.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
